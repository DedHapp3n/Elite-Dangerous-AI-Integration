<div class="engineers-container">
  <mat-tab-group>
    <mat-tab label="Ship">
      <div class="engineers-filters">
        <mat-button-toggle-group [(ngModel)]="engineerFilter" aria-label="Engineer Status">
          <mat-button-toggle value="all">All</mat-button-toggle>
          <mat-button-toggle value="unlocked">Unlocked</mat-button-toggle>
          <mat-button-toggle value="invited">Invited</mat-button-toggle>
          <mat-button-toggle value="known">Known</mat-button-toggle>
          <mat-button-toggle value="locked">Locked</mat-button-toggle>
        </mat-button-toggle-group>
      </div>

      <div class="engineers-table-container">
        <table class="engineers-table">
          <thead>
            <tr>
              <th>Engineer</th>
              <th>Rank</th>
              <th>Modifies</th>
              <th>Location</th>
              @if (engineerFilter === 'all') {
                <th>How to Find</th>
                <th>How to Get Invite</th>
                <th>How to Unlock</th>
                <th>How to Gain Rep</th>
              }
              @if (engineerFilter === 'unlocked') { <th>How to Gain Rep</th> }
              @if (engineerFilter === 'invited') { <th>How to Unlock</th> }
              @if (engineerFilter === 'known') { <th>How to Get Invite</th> }
              @if (engineerFilter === 'locked') { <th>How to Find</th> }
            </tr>
          </thead>
          <tbody>
            @for (engineer of getFilteredShipEngineers(); track engineer.Engineer) {
              <tr [ngClass]="{
                'engineer-unlocked': engineer.Progress === 'Unlocked', 
                'engineer-invited': engineer.Progress === 'Invited', 
                'engineer-known': engineer.Progress === 'Known', 
                'engineer-locked': !engineer.Progress
              }">
                <td>
                  <div class="engineer-name">{{ engineer.Engineer }}
                    <span [ngClass]="'status-badge ' + (engineer.Progress?.toLowerCase() || 'locked')">
                      {{ engineer.Progress || 'Locked' }}
                    </span></div>
                </td>
                <td>
                  @if (engineer.Rank !== undefined) {
                    <div class="engineer-rank">
                      <div class="rank-stars">
                        @for (i of getArray(engineer.Rank); track i) { <span class="star filled">★</span> }
                        @for (i of getArray(5-engineer.Rank); track i) { <span class="star empty">☆</span> }
                      </div>
                      @if (engineer.Rank < 5) {
                        <div class="rank-progress"><div class="progress-bar" [style.width.%]="engineer.RankProgress"></div></div>
                      }
                    </div>
                  } @else { <div>-</div> }
                </td>
                <td><div class="engineer-mods">{{ getEngineerModules(engineer.Engineer) }}</div></td>
                <td><div class="engineer-location">{{ getEngineerLocation(engineer.Engineer) }}</div></td>
                @if (engineerFilter === 'all') {
                  <td><div class="engineer-find">{{ engineer.HowToFind }}</div></td>
                  <td><div class="engineer-invite">{{ engineer.HowToGetInvite }}</div></td>
                  <td><div class="engineer-unlock">{{ engineer.HowToUnlock }}</div></td>
                  <td><div class="engineer-rep">{{ engineer.HowToGainRep }}</div></td>
                }
                @if (engineerFilter === 'unlocked') { <td><div class="engineer-rep">{{ engineer.HowToGainRep }}</div></td> }
                @if (engineerFilter === 'invited') { <td><div class="engineer-unlock">{{ engineer.HowToUnlock }}</div></td> }
                @if (engineerFilter === 'known') { <td><div class="engineer-invite">{{ engineer.HowToGetInvite }}</div></td> }
                @if (engineerFilter === 'locked') { <td><div class="engineer-find">{{ engineer.HowToFind }}</div></td> }
              </tr>
            }
          </tbody>
        </table>
      </div>
    </mat-tab>

    <mat-tab label="On-Foot">
      <div class="engineers-filters">
        <mat-button-toggle-group [(ngModel)]="onFootEngineerFilter" aria-label="Engineer Status">
          <mat-button-toggle value="all">All</mat-button-toggle>
          <mat-button-toggle value="unlocked">Unlocked</mat-button-toggle>
          <mat-button-toggle value="invited">Invited</mat-button-toggle>
          <mat-button-toggle value="known">Known</mat-button-toggle>
          <mat-button-toggle value="locked">Locked</mat-button-toggle>
        </mat-button-toggle-group>
      </div>

      <div class="engineers-table-container">
        <table class="engineers-table">
          <thead>
            <tr>
              <th>Engineer</th>
              <th>Modifies</th>
              <th>Location</th>
              @if (onFootEngineerFilter === 'all') {
                <th>How to Find</th>
                <th>How to Get Invite</th>
                <th>Referral</th>
              }
              @if (onFootEngineerFilter === 'unlocked') { <th>Referral</th> }
              @if (onFootEngineerFilter === 'known') { <th>How to Get Invite</th> }
              @if (onFootEngineerFilter === 'locked') { <th>How to Find</th> }
            </tr>
          </thead>
          <tbody>
            @for (engineer of getFilteredOnFootEngineers(); track engineer.Engineer) {
              <tr [ngClass]="{
                'engineer-unlocked': engineer.Progress === 'Unlocked', 
                'engineer-invited': engineer.Progress === 'Invited', 
                'engineer-known': engineer.Progress === 'Known', 
                'engineer-locked': !engineer.Progress
              }">
                <td>
                  <div class="engineer-name">{{ engineer.Engineer }}
                    <span class="status-badge" [ngClass]="engineer.Progress ? engineer.Progress.toLowerCase() : 'locked'">
                      {{ engineer.Progress || 'Locked' }}
                    </span>
                  </div>
                </td>
                <td><div class="engineer-mods">{{ getOnFootEngineerModules(engineer.Engineer) }}</div></td>
                <td><div class="engineer-location">{{ getEngineerLocation(engineer.Engineer) }}</div></td>
                @if (onFootEngineerFilter === 'all') {
                  <td><div class="engineer-find">{{ engineer.HowToFind }}</div></td>
                  <td><div class="engineer-invite">{{ engineer.HowToGetInvite }}</div></td>
                  <td><div class="engineer-rep">{{ engineer.HowToReferral }}</div></td>
                }
                @if (onFootEngineerFilter === 'unlocked') { <td><div class="engineer-rep">{{ engineer.HowToReferral }}</div></td> }
                @if (onFootEngineerFilter === 'known') { <td><div class="engineer-invite">{{ engineer.HowToGetInvite }}</div></td> }
                @if (onFootEngineerFilter === 'locked') { <td><div class="engineer-find">{{ engineer.HowToFind }}</div></td> }
              </tr>
            }
          </tbody>
        </table>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>


